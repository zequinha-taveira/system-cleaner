name: ðŸ·ï¸ Auto Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to release (e.g., v1.0.1)'
        required: true
        type: string

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  create-release:
    name: ðŸ·ï¸ Create Release
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: ðŸ·ï¸ Get Version
        id: version
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            VERSION="${{ github.event.inputs.version }}"
          else
            VERSION=${GITHUB_REF#refs/tags/}
          fi
          echo "version=$VERSION" >> $GITHUB_OUTPUT
          echo "ðŸ·ï¸ Version: $VERSION"
          
      - name: ðŸ“ Generate Changelog
        id: changelog
        run: |
          echo "ðŸ“ Generating changelog..."
          
          # Criar changelog bÃ¡sico
          cat > RELEASE_NOTES.md << 'EOF'
          ## ðŸŽ‰ System Cleaner ${{ steps.version.outputs.version }}
          
          ### âœ¨ Funcionalidades
          - ðŸ§ **Script Linux**: CompatÃ­vel com mÃºltiplas distribuiÃ§Ãµes
          - ðŸªŸ **Script Windows**: PowerShell com verificaÃ§Ã£o de admin
          - ðŸŒ **Site Moderno**: Interface responsiva com modo escuro
          - ðŸ“Š **3 NÃ­veis de Limpeza**: Leve, MÃ©dia, Profunda
          - ðŸ“ **Logs Detalhados**: Sistema completo de logging
          - â° **AutomaÃ§Ã£o**: CompatÃ­vel com cron e Task Scheduler
          
          ### ðŸš€ InstalaÃ§Ã£o RÃ¡pida
          
          #### Linux
          ```bash
          wget https://github.com/${{ github.repository }}/releases/download/${{ steps.version.outputs.version }}/linux-cleaner.sh
          chmod +x linux-cleaner.sh && ./linux-cleaner.sh --media
          ```
          
          #### Windows (PowerShell como Admin)
          ```powershell
          iwr "https://github.com/${{ github.repository }}/releases/download/${{ steps.version.outputs.version }}/windows-cleaner.ps1" -OutFile "windows-cleaner.ps1"
          .\windows-cleaner.ps1 -Mode media
          ```
          
          ### ðŸ“Š EstatÃ­sticas
          - **Tamanho Linux Script**: $(stat -c%s linux-cleaner.sh | numfmt --to=iec)
          - **Tamanho Windows Script**: $(stat -c%s windows-cleaner.ps1 | numfmt --to=iec)
          - **Linhas de CÃ³digo**: $(wc -l *.sh *.ps1 | tail -1 | awk '{print $1}')
          
          ### ðŸ”’ Checksums
          ```
          $(sha256sum linux-cleaner.sh)
          $(sha256sum windows-cleaner.ps1)
          ```
          
          ---
          **âš¡ Mantenha seu sistema sempre otimizado!**
          EOF
          
          echo "âœ… Changelog generated"
          
      - name: ðŸ·ï¸ Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.version.outputs.version }}
          name: ðŸ§¹ System Cleaner ${{ steps.version.outputs.version }}
          body_path: RELEASE_NOTES.md
          files: |
            linux-cleaner.sh
            windows-cleaner.ps1
          draft: false
          prerelease: false
          generate_release_notes: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ðŸ“¢ Release Created
        run: |
          echo "ðŸŽ‰ Release ${{ steps.version.outputs.version }} created successfully!"
          echo "ðŸ”— URL: https://github.com/${{ github.repository }}/releases/tag/${{ steps.version.outputs.version }}"
